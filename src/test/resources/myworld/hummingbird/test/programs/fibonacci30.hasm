.symbols
    fibonacci function $fibonacci
            long
            parameters 3
            registers 7

.code
  # fib(30)
  CONST ri1, 30
  CONST ri2, 1
  CONST ri3, 2
  CALL ri0, %fibonacci, ri1, 3
  RETURN ri0
  fibonacci:
    # Params (ri0 = n, ri1 = 1, ri2 = 2)
    IFGE ri0, ri2, $recurse
    RETURN ri0
  recurse:
    #fib(n - 1)
    SUB ri0, ri0, ri1 # ri1 = n - 1
    CALL ri4, %fibonacci, ri0, 3

    #fib(n - 2)
    SUB ri0, ri0, ri1 # ri1 = n - 2
    CALL ri0, %fibonacci, ri0, 3

    ADD ri0, ri0, ri4
    RETURN ri0