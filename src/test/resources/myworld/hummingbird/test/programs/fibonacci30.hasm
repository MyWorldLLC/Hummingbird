.symbols
    fibonacci function $fibonacci
            int
            parameters 1

.code
  # fib(30)
  CONST ri1, 30
  CALL $fibonacci
  RETURN
  fibonacci:
    SAVE ri1, 4 # save ri1-ri4
    CONST ri2, 2
    IFGE ri1, ri2, $recurse
    COPY ri0, ri1
    RESTORE ri1, 4
    RETURN
  recurse:
    # Constants (ri1 = n)
    CONST ri2, 1
    CONST ri3, 2

    # ri4 = n
    COPY ri4, ri1

    #fib(n - 1)
    SUB ri1, ri4, ri2 # ri1 = n - 1
    CALL $fibonacci
    COPY ri2, ri0 # ri2 = fib(n - 1)

    #fib(n - 2)
    SUB ri1, ri4, ri3 # ri1 = n - 2
    CALL $fibonacci

    ADD ri0, ri0, ri2
    RESTORE ri1, 4
    RETURN